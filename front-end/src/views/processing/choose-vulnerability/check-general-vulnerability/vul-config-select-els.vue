<template>
  <div class="container" id="add-seg-sc">
    <div id="header">
      <span id="vul-name">{{config_vul.name}}</span> Configuration - Select elements of SC to check
    </div>
    <div class="container nav-tabs">
      <ul class="nav nav-tabs">
        <li class="nav-item" :style="{maxWidth: 100/(size_dict(list_scs)+1) + '%'}" v-for="(item, id) in list_scs" :key="id">
          <a class="nav-link text-truncate" v-on:click="selected_sc = id" v-bind:class="{ active: id == selected_sc}">{{ item.name }}</a>
          <title class="ttip">{{item.name}}</title>
        </li>
      </ul>
    </div>
    <div class="container" style="border: black solid; padding-bottom: 10px" v-if="size_dict(list_scs)">
      <list-gvs :data="list_scs[getSelected].list_gvs" :sc_id="getSelected" :vul_id="config_vul.id"></list-gvs>
      <list-lvs :data="list_scs[getSelected].list_functions" :sc_id="getSelected" :vul_id="config_vul.id"></list-lvs>
    </div>
    <div v-else class="error-handle" style="color: red;">
        <h3>Currently you are not choosing any smart contract</h3>
    </div>
    <div class="container" style="width: 50%">
      <button @click="routing('next')" type="button" class="btn btn-outline-primary btn-sm">Next</button>
      <button @click="routing('back')" type="button" class="btn btn-outline-secondary btn-sm">Back</button>
    </div>
    <div></div>
  </div>
</template>

<script>
import {GetSmartContractFunctionInfor} from "../../../../services/data"
import ListGVs from "./ListGVs.vue";
import ListLVs from "./ListFuncs.vue";

export default {
  methods: {
    routing(param){
      if(param == "next"){
        let temp = this.$store.getters["data/GetFourthStepViewsList"];
        temp[2] = {"name": "vulcon-summary"};
        this.$store.commit("data/SetFourthStepViewsList",temp)
        this.$store.commit("data/SetFourthStepViews","vulcon-summary")
        // this.$emit("changeView",3)
      }
      if(param == "back"){
        this.$store.commit("data/SetFourthStepViews","check-general-vul")
        this.$emit("changeView",2)
      }
    },
    size_dict(d){
      return Object.keys(d).length
    }
  },
  computed: {
    getSelected(){
      return this.selected_sc
    },
    getInfo(){
      return this.$store.getters["data/GetSCSelectedInfor"]
    }
  },
  data() {
    return {
      selected_sc: null,
      list_scs: {},
      config_vul: null,
    };
  },
  mounted(){
    var vul = this.$store.getters["data/GetConfigVul"]
    var selected_vuls = this.$store.getters["data/GetSelectedVulnerbility"];
    if(selected_vuls.length > 0 && vul.id){
      if(vul.id){
        var v = selected_vuls.filter(el => (el.id == vul.id));
        if(v.length > 0) this.config_vul = v[0];
        else this.config_vul = selected_vuls[0]
      }else{
        this.config_vul = selected_vuls[0]
      }
    }
    
    this.list_scs = GetSmartContractFunctionInfor(this.$store.getters["data/GetSelectedSC"])
      for (let k in this.list_scs) {
        this.selected_sc = k
        break
      }
    
  },
  components: {
    "list-gvs": ListGVs,
    "list-lvs": ListLVs,
  },
  
};
</script>

<style scoped>
.container{
  text-align: center;
}
#header {
  font-size: 27px;
  margin-top: 0;
  margin-bottom: 10px;
}
#add-seg-sc{
  width: 80%;
}
.title {
  text-align: center;
  font-size: 1.5em;
  font-weight: bold;
}
select {
  width: 100%;
  margin: 0;
}
.form-control {
  height: 100px;
  overflow: auto;
}
.row {
  margin: 2% 0%;
  text-align: left;
  width: 100%;
}

.nav-item .active {
  color: white;
  background-color: #383838;
  border: grey;
}

.nav-link {
  color: #383838;
  border: grey solid;
  border-bottom: none;
}
.nav-item {
  width: 250px;
  margin-right: 3px;
}
.col-9,
.col-3 {
  padding: 0;
}

.chosen {
  color: white;
  background: #383838;
}
button{
  margin: 7%;
  width: 100px;
}
a:hover{
  cursor: pointer;
}
.nav li .ttip{
  font-size: 12px;
  position: absolute;
  display: none;
}
.nav li:hover .ttip{
  display: inline;
  background-color: black;
  opacity: 0.8;
  color: white;
  padding: 5px;
  border-radius: 3px;
  margin: 0;
}
#vul-name{
  color: blue;
}
@media only screen and (max-width: 960px){
  [class*="container"] {
  width: 100%;
}
#add-seg-sc{
  width: 100%;
}

}
</style>s