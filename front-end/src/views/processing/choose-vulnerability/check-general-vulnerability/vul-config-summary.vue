<template>
  <div class="container " id="main">
    <div class="container" id="header">
      Vulnerability/CS-Property Configuration - Summary
    </div>
    <div class="row" style="margin-bottom: 5%">
      <div class="col-2">Vulnerability/CS-Property</div>
      <div class="col-9">
        <select class="form-select" v-model="config_vul" @change="changeConfigVul">
          <option v-for="vul in list_vulnerabilities" :key="vul.id" :value="vul">
            {{ vul.name }}
          </option>
        </select>
      </div>
    </div>
    <div v-for="c in list_scs" v-bind:key="c.id" class="full-size selected-els">
      <selected-els :sc_id="c.id" :sc_name="c.name" :vul_id="getConfigVul.id"/>
    </div>
    <!--End main box-->
    <div class="container" style="width: 70%; margin-top: 5%">
      <button @click="routing('finish')" class="btn btn-outline-primary btn-sm">
        Finish
      </button>
      <button @click="routing('back')" class="btn btn-outline-secondary btn-sm">
        Back
      </button>
      <button @click="routing('cancel')" class="btn btn-outline-secondary btn-sm">
        Cancel
      </button>
    </div>
  </div>
</template>


<script>
import SelectedElements from "./SelectedElements.vue"
export default {
  components: {
    "selected-els": SelectedElements
  },
  computed: {
      list_scs() {
        return this.$store.getters["data/GetSelectedSC"]
      },
      getConfigVul(){
        return this.$store.getters["data/GetConfigVul"]
      }
  },
  methods: {
    changeConfigVul(){
      this.$store.commit("data/SetConfigVul", this.config_vul);
    },
    routing(param) {
      if(param == "finish"){
        this.$store.commit("data/SetFourthStepViews","check-general-vul")
        this.$emit("changeView",2)
      }
      if(param == "back"){
        let temp = this.$store.getters["data/GetFourthStepViewsList"];
        temp.pop();
        temp.push({"name": "vulcon-select-els"});
        this.$store.commit("data/SetFourthStepViewsList",temp)
        this.$store.commit("data/SetFourthStepViews","vulcon-select-els")
      }
      if(param == "cancel"){
        this.$store.commit("data/SetFourthStepViews","property-coptions")
        this.$emit("changeView",1)
      }
    },
    isSelected(sc_id) {
        var gvs = this.$store.state.data.selectedSCInfor[sc_id].list_gvs.length > 0 ? true : false
        var lvs = this.$store.state.data.selectedSCInfor[sc_id].list_lvs.length > 0 ? true : false
        return gvs || lvs
    }
  },
  data() {
    return {
      list_vulnerabilities: [],
      config_vul: null,
      }
  },
  mounted() {
      var vul = this.$store.getters["data/GetConfigVul"]
      var selected_vuls = this.$store.getters["data/GetSelectedVulnerbility"];
      if(selected_vuls.length > 0 && vul.id){
        if(vul.id){
          var v = selected_vuls.filter(el => (el.id == vul.id));
          if(v.length > 0) this.config_vul = v[0];
          else this.config_vul = selected_vuls[0]
        }else{
          this.config_vul = selected_vuls[0]
        }
      }
      this.list_vulnerabilities = selected_vuls
  }
}
</script>

<style scoped>
#main{
  width: 70%;
}
select {
  width: 100%;
  margin: 0;
}
.form-control {
  height: 100px;
  overflow: auto;
}
#header {
  font-size: 27px;
  margin-top: 0;
  margin-bottom: 10px;
}
.table-list {
  width: 100%;
  margin: auto;
  font-size: 0.9em;
  height: 250px;
  overflow-y: auto;
  border-radius: 10px;
  border-color: rgba(204, 203, 203, 0.733);
  border-style: solid;
}
.up-down {
  display: inline;
  float: right;
}
span:hover {
  cursor: pointer;
  opacity: 0.9;
  color: dimgrey;
}
.table-list .row {
  height: 30px;
  background-color: #ffffff;
  border-top: 1px solid #dee2e6;
  vertical-align: middle;
  align-items: center;
  margin: 0;
}
.select {
  text-align: center;
}
button {
  margin: 3%;
  width: 80px;
}
div{
  text-align: center;
}
@media only screen and (max-width: 768px){
  [class*="col-"] {
  width: 100%;
}
.row{
  margin: 10% 0 10% 0;
}
h1, h2{
  font-size: 150%;
}
.full-size{
  width: 100%;
}
#main{
  width: 100%;
}
}
</style>