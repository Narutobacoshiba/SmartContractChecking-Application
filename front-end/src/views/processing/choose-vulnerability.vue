<template>
  <div id="chvu-body">
    <div id="chvu-selview">
      <div id="chvu-holder">
        <div class="chvu-selview-element" v-if="getViewListLength > 0">
          <div
            class="chse-items"
            id="chse-element-I"
            :class="{ div_choosen_element: getChoosenElement == 1 }"
            @click="changeElement(1)"
          >
            <div class="chse-items-number" id="st1"></div>
          </div>
          <div class="chse-items-label">Step 1</div>
        </div>
        <div class="chvu-selview-element" v-if="getViewListLength > 1">
          <div
            class="chse-items"
            id="chse-element-I"
            :class="{ div_choosen_element: getChoosenElement == 2 }"
            @click="changeElement(2)"
          >
            <div class="chse-items-number" id="st2"></div>
          </div>
          <div class="chse-items-label">Step 2</div>
        </div>
        <div class="chvu-selview-element" v-if="getViewListLength > 2">
          <div
            class="chse-items"
            id="chse-element-I"
            :class="{ div_choosen_element: getChoosenElement == 3 }"
            @click="changeElement(3)"
          >
            <div class="chse-items-number"></div>
          </div>
          <div class="chse-items-label">Step 3</div>
        </div>
        <div class="chvu-selview-element" v-if="getViewListLength > 3">
          <div
            class="chse-items"
            id="chse-element-I"
            :class="{ div_choosen_element: getChoosenElement == 4 }"
            @click="changeElement(4)"
          >
            <div class="chse-items-number"></div>
          </div>
          <div class="chse-items-label">Step 4</div>
        </div>
      </div>
    </div>
    <div id="chvu-view">
      <div class="footer">
        <button
          id="rpage-back"
          class="btn btn-outline-primary btn-sm"
          @click="goBack"
        >
          <span class="material-icons icon">west </span>
          <span>Back</span>
        </button>
        <button id="rpage-next" @click="goNext" v-if="displayNext">NEXT</button>
      </div>

      <PropertyCoptions
        @changeView="updateElement"
        @cap="capt"
        v-if="getView == 'property-coptions'"
      />
      <!-- check-csp -->
      <CspsChooseTypes
        @changeView="updateElement"
        @cap="capt"
        v-if="getView == 'csps-choosetypes'"
      />
      <CspConfiguration
        @changeView="updateElement"
        v-if="getView == 'csp-configuration'"
      />
      <CspsNonTemp
        @changeView="updateElement"
        v-if="getView == 'csps-nontemp'"
      />
      <!-- check-general-vulnerability -->
      <GeneralVulSetting
        @changeView="updateElement"
        @cap="capt"
        v-if="getView == 'check-general-vul'"
      />
      <VulConfigChooseVul
        @changeView="updateElement"
        @cap="capt"
        v-if="getView == 'vulcon-choosevul'"
      />
      <VulConfigSelectEls
        @changeView="updateElement"
        v-if="getView == 'vulcon-select-els'"
      />
      <VulConfigSummary
        @changeView="updateElement"
        v-if="getView == 'vulcon-summary'"
      />
    </div>
  </div>
</template>

<script>
import PropertyCoptions from "./choose-vulnerability/property-coptions.vue";
import CspsChooseTypes from "./choose-vulnerability/check-csp/csps-choosetypes.vue";
import CspConfiguration from "./choose-vulnerability/check-csp/csp-configuration.vue";
import CspsNonTemp from "./choose-vulnerability/check-csp/csps-nontemp.vue";
import GeneralVulSetting from "./choose-vulnerability/check-general-vulnerability/general-vul-setting.vue";
import VulConfigChooseVul from "./choose-vulnerability/check-general-vulnerability/vul-config-choosevul.vue";
import VulConfigSelectEls from "./choose-vulnerability/check-general-vulnerability/vul-config-select-els.vue";
import VulConfigSummary from "./choose-vulnerability/check-general-vulnerability/vul-config-summary.vue";
import html2canvas from "html2canvas";
export default {
  components: {
    PropertyCoptions,
    CspsChooseTypes,
    CspConfiguration,
    CspsNonTemp,
    GeneralVulSetting,
    VulConfigChooseVul,
    VulConfigSelectEls,
    VulConfigSummary,
  },
  data() {
    return {
      choosen_element: 1,
    };
  },
  mounted() {
    this.choosen_element =
      this.$store.getters["data/GetFourthStepViewsList"].length;
    console.log(this.$store.getters["data/GetFourthStepViewsList"].length);
  },
  computed: {
    getViewListLength() {
      return this.$store.getters["data/GetFourthStepViewsList"].length;
    },
    getView() {
      return this.$store.getters["data/GetFourthStepViews"];
    },
    getChoosenElement() {
      return this.choosen_element;
    },
    displayNext() {
      return (
        this.getView == "csp-configuration" || this.getView == "vulcon-summary" || this.getView == "check-general-vul"
      );
    },
    getSteps() {
      return this.$store.getters["data/GetFourthStepViewsList"];
    },
  },
  methods: {
    capt(eleCap,eleApe) {
      this.capture(eleCap,eleApe);
    },
    updateElement(value) {
      this.choosen_element = value;
    },
    goBack() {
      this.$store.commit("data/SetProcessView", "select-context");
    },
    goNext() {
      this.$store.commit("data/SetProcessView", "generate-sc2cpn");
    },
    changeElement(value) {
      this.choosen_element = value;
      let temp = this.$store.getters["data/GetFourthStepViewsList"][value - 1];
      this.$store.commit("data/SetFourthStepViews", temp.name);
    },
    getElement(value) {
      let temp = this.$store.getters["data/GetFourthStepViewsList"][value - 1];
      return temp;
    },
    capture(eleCapture,eleApend) {
      console.log(eleCapture)
      console.log(eleApend)
      html2canvas(document.querySelector(eleCapture), {
        scale: 2,
      }).then(function (canvas) {
        canvas.style.width = "100%";
        canvas.style.height = "100%";
        console.log(canvas)
        if(!document.querySelector(`#${eleApend}`).hasChildNodes(canvas)){
          document.querySelector(`#${eleApend}`).appendChild(canvas);
        }
      });
    },
  },
};
</script>


<style scoped>
#chvu-body {
  width: 100%;
  height: 663.6px;
}
#chvu-selview {
  float: left;
  width: 242px;
  height: 100%;
  background-color: rgb(71, 70, 69);
  overflow-y: scroll;
}
#chvu-holder {
  width: 70%;
  height: 100%;
  margin: 0 auto;
  display: flex;
  flex-direction: column;
  justify-content: center;
}
.chvu-selview-element {
  flex-basis: 33%;
  width: 100%;
}
.div_choosen_element {
  border: 5px solid rgb(88, 88, 240);
}
.chse-items {
  margin-top: 18%;
  width: 100%;
  height: 70%;
  /* background-image: url(../../assets/choose_vul_page1.png); */
  background-size: contain;
}
.chse-items-number {
  width: 100%;
  height: 100%;
  background-color: rgba(224, 222, 222, 0.6);
  cursor: pointer;
}
.chse-items-number:hover {
  background-color: rgba(224, 222, 222, 0);
}
.div_choosen_element .chse-items-number {
  background-color: rgba(224, 222, 222, 0);
}
.chse-items-label {
  font-size: 14px;
  margin: 3px;
  text-align: center;
  color: white;
}
#chvu-view {
  display: inline-block;
  width: calc(100% - 242px);
  height: 100%;
  overflow-y: auto;
}
#rpage-back {
  align-items: center;
  justify-content: center;
  cursor: pointer;
}
#rpage-back span {
  font-size: 16px;
}
#rpage-back .icon {
  font-size: 14px;
  font-weight: bold;
  margin-right: 5px;
}
#rpage-next {
  width: 80px;
  height: 32px;
  font-size: 15px;
  color: white;
  background-color: #fd605e;
  padding: 5px 19px;
  border-radius: 20px;
  cursor: pointer;
  float: right;
  margin-right: 40px;
}
#rpage-next:hover {
  background-color: #f57b79;
}
button {
  margin: 20px;
  margin-bottom: 0;
}
</style>
